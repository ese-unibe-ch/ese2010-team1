#{extends 'main.html' /}
#{set title:'ajopi' /}

<ul>
#{list items:questions, as:'question'}
	#{entry entry:question, user:user /}
#{/list}
</ul>

#{if user}

	<h1>Ask Question</h1>
	#{form @Secured.newQuestion()}
		#{field 'content'}
			<input type="text" name="title" id="title" value="Title" />
        	<textarea name="${field.name}" class="${field.errorClass}"></textarea>
		#{/field}
		<input type="text" name="tags" id="tags" value="Tags" />
		
	
		
		<input type="submit" value="Post" />
	#{/form}
	
	 <script type="text/javascript">
	 var tags;
	 		function split( val ) {
			return val.split( /,\s*/ );
		}
		function extractLast( term ) {
			return split( term ).pop();
		}
	$(function() {
		var tagsList = #{jsAction @Application.getTagList() /};
		
		$.getJSON(tagsList(), function(data) {
			tags = data;
		});
		
		$( 'input#tags' ).autocomplete({
			minLength: 0,
			source: function( request, response ) {
				response( $.ui.autocomplete.filter(
					tags, extractLast( request.term ) ) );
			},
			focus: function() {
				return false;
			},
			select: function( event, ui ) {
				var terms = split(this.value);
				terms.pop();
				terms.push( ui.item.value );
				terms.push( "" );
				this.value = terms.join( ", " );
				return false;
			}
		});
	});
	</script>
		

#{/if}

<span style="color: white;">Anzahl User: ${userCount}</span>